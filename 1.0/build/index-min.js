/*! formValidation - v1.0 - 2013-08-27 11:56:48 AM
* Copyright (c) 2013 淘知了; Licensed  */
KISSY.add("gallery/formValidation/1.0/index",function(a,b,c){function d(a){var b=this;d.superclass.constructor.call(b,a);var c=N.one("#"+this.get("form")),e=this.get("blurValidate");if(this._bindSubmit(c),e){var f=c.all("input[type=text],textarea");this.bindBlur(f)}}return b.all,a.extend(d,c,{_bindSubmit:function(a){var b=this;a&&a.on("submit",function(){var a=!1,c=b.validateForm(),d=b.fire("testSucc",{form:b.get("form")});return c&&d&&(a=!0),a})},bindBlur:function(a){for(var b=this,c=function(){},d=function(){b.validateField(this)},e=0;e<a.length;e++)N.one(a[e]).on("focus",c).on("blur",d)},validateForm:function(a){var b=!0;a||(a=N.one("#"+this.get("form"))[0]);for(var c=0;c<a.elements.length;c++){var d=a.elements[c];"OBJECT"!=d.tagName&&(this.hideErrors(d),this.validateField(d)&&(b=!1))}return b&&this.on("testSucc",function(){return!0}),b},validateField:function(a){var b=[],c=this.get("rules"),d=a.getAttribute("data-rulenames");if(!d)return!1;for(var e=d.split(";"),f="",g=0;g<e.length;g++){var h=e[g];if(h in c&&(f=c[h],!f.test(a))){b.push(f.msg);break}}return b.length?this.showErrors(a,b,f.msg):this.hideErrors(a),b.length>0},showErrors:function(a,b,c){this.fire("showError",{ele:a,error:b,msg:c})},hideErrors:function(a){this.fire("hideError",{ele:a})}},{ATTRS:{form:{value:"formid"},rules:{value:{},setter:function(b){var c=this.get("rules");return a.mix(c,b)}},blurValidate:{value:!0}}}),d},{requires:["node","base"]});